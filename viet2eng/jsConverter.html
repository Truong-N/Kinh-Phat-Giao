<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>converter</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        textarea {
            width: 80%;
            height: 500px;
        }
    </style>
</head>
<body>
    <a name="rawTA"></a>
    <div >
        Raw Text
        <button type="button" onclick="saveRaw()">Save</button>
        <button type="button" onclick="retrieveRaw()">Retrieve</button>
        Go to:
        <a href="#separateTA">SeparateTA</a>
        <a href="#condenseTA">CondenseTA</a>
        <a href="#translateTA">TranslateTA</a>
        <a href="#condenseTranslateTA">CondenseTranslateTA</a>
        <a href="#combineTA">CombineTA</a>
    </div>

    <textarea id="rawTA"></textarea>

    <a name="separateTA"></a>
    <div>
        Process Text
        <button type="button" onclick="separate()">Separate</button>
        <button type="button" onclick="separate2clipboard()">clipboard</button>
        Go to:
        <a href="#rawTA">RawTA</a>
        <!-- <a href="#separateTA">SeparateTA</a> -->
        <a href="#condenseTA">CondenseTA</a>
        <a href="#translateTA">TranslateTA</a>
        <a href="#condenseTranslateTA">CondenseTranslateTA</a>
        <a href="#combineTA">CombineTA</a>
    </div>
    
    <textarea id="separateTA"></textarea>
    
    <a name="condenseTA"></a>
    <div>
        Condensed Text
        <button type="button" onclick="condense()">Condense</button>
        <button type="button" onclick="condense2clipboard()">clipboard</button>
        Go to:
        <a href="#rawTA">RawTA</a>
        <a href="#separateTA">SeparateTA</a>
        <!-- <a href="#condenseTA">CondenseTA</a> -->
        <a href="#translateTA">TranslateTA</a>
        <a href="#condenseTranslateTA">CondenseTranslateTA</a>

        <a href="#combineTA">CombineTA</a>
    </div>
    
    <textarea id="condenseTA"></textarea>
    
    <a name="translateTA"></a>
    <div>
        Translated Text
        <!-- <button type="button" onclick="convertGtLt()">Convert Gt Lt</button> -->
        <button type="button" onclick="saveTranslate()">Save</button>
        <button type="button" onclick="retrieveTranslate()">Retrieve</button>
        Go to:
        <a href="#rawTA">RawTA</a>
        <a href="#separateTA">SeparateTA</a>
        <a href="#condenseTA">CondenseTA</a>
        <!-- <a href="#translateTA">TranslateTA</a> -->
        <a href="#condenseTranslateTA">CondenseTranslateTA</a>
        <a href="#combineTA">CombineTA</a>
    </div>

    <textarea id="translateTA"></textarea>
    
    <a name="condenseTranslateTA"></a>
    <div>
        Condense Translate 
        <button type="button" onclick="condenseTranslate()">Condense</button>
        <button type="button" onclick="condenseTranslate2clipboard()">clipboard</button>
        Go to:
        <a href="#rawTA">RawTA</a>
        <a href="#separateTA">SeparateTA</a>
        <a href="#condenseTA">CondenseTA</a>
        <a href="#translateTA">TranslateTA</a>
        <!-- <a href="#condenseTranslateTA">CondenseTranslateTA</a> -->
        <a href="#combineTA">CombineTA</a>
    </div>

    <textarea id="condenseTranslateTA"></textarea>

    <a name="combineTA"></a>
    <div>
        <button type="button" onclick="combine()">Combine</button>;
        Go to:
        <a href="#rawTA">RawTA</a>
        <a href="#separateTA">SeparateTA</a>
        <a href="#condenseTA">CondenseTA</a>
        <a href="#translateTA">TranslateTA</a>
        <a href="#condenseTranslateTA">CondenseTranslateTA</a>
    </div>
    <textarea id="combineTA"></textarea>
    <script>
        function saveRaw(){
            rawTA.select()
            localStorage.setItem("raw", rawTA.value)
        }
        function retrieveRaw(){
            rawTA.value = localStorage.getItem("raw")
        }
        function saveTranslate(){
            translateTA.select()
            localStorage.setItem("translate", translateTA.value)
        }
        function retrieveTranslate(){
            translateTA.value = localStorage.getItem("translate")
        }
        function separate() {
            let sumLength = 0
            let txt = rawTA.value
                .replaceAll(". ", ".. ")
                .replaceAll(": ", ":: ")
                .replaceAll("; ", ";; ")
                .replaceAll("? ", "?? ")
                .replaceAll("! ", "!! ")
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
            let array = txt
                .split('\n') // split to array
                .filter(e => e.length>1) // remove empty lines
                .map((e,i) => { // each array is a paragraph, out put array number, total length
                    if(sumLength+e.length>4700)sumLength=e.length
                    else sumLength += e.length
                    return `${i}\n${e.length}\n${sumLength}\n`+e.trim()
                })
            array = array.map(e => e.split(/[.;:?!] /g).join("\n"))
            separateTA.value = array.join("\n")
        }
        function separate2clipboard(){
            separateTA.select()
            navigator.clipboard.writeText(separateTA.value)
        }
        function condense() {
            let txt = separateTA.value
            // console.log(txt)
            // convert to array
            let arr = txt.split('\n')
            let arr1 = []
            let i = 0;
            do {
                if ( isFinite(arr[i])){
                    arr1.push(arr[i])
                    i++;
                    i++;
                    i++;
                } else {
                    arr1.push(arr[i])
                    i++
                }

            } while (i < arr.length)            // console.log(arr1)
            // remove empty line
            // arr1 = arr1.filter(e => e.length > 1)
                // convert paragraph number to '~~ '
            arr = arr1.map(e => isFinite(e)? "~~ ": e+'~ ')
            txt = arr.join('')//
            txt = txt.replaceAll('~ ~~', '~~')
            // console.log(arr)
            condenseTA.value = txt
        }
        // function convertGtLt(){
        //     translateTA.value = translateTA.value.replaceAll('<', '&lt;').replaceAll('>', '&gt;')
        // }
        function condense2clipboard(){
            condenseTA.select()
            navigator.clipboard.writeText(condenseTA.value)
        }

        function condenseTranslate() {
            let txt = translateTA.value
            // console.log(txt)
            // convert to array
            let arr = txt.split('\n')
            // remove empty line
                .filter(e => e.length > 0)
            let i = 0;
            let arr1 = []

            do {
                if ( isFinite(arr[i])){
                    arr1.push(arr[i])
                    i++;
                    i++;
                    i++;
                } else {
                    arr1.push(arr[i])
                    i++
                }

            } while (i < arr.length)
                // convert paragraph number to '~~ '
            arr = arr1.map(e => isFinite(e)? "~~ ": e+'~ ').join('').replaceAll('~ ~~', '~~')
            console.log(arr)
            condenseTranslateTA.value = arr
        }
        function condenseTranslate2clipboard(){
            condenseTranslateTA.select()
            navigator.clipboard.writeText(condenseTranslateTA.value)
        }

        function combine() {
            let condenseArray = condenseTA.value
                .replaceAll("&lt;", "<")
                .replaceAll("&gt;", ">")
            .split('~~')
            let condenseTranslateArray = condenseTranslateTA.value
                .replaceAll("&lt;", "<")
                .replaceAll("&gt;", ">")
            .split('~~')
            let iLength = 0
            if (condenseArray.length === condenseTranslateArray.length){
                iLength = condenseArray.length
            } else {
                iLength = Math.min(condenseArray.length, condenseTranslateArray.length)
                alert("Array lengths not equal")
            }
            let str = ''
            for (let i = 0; i < iLength; i++){
                let condArray = condenseArray[i].split('~')
                let condTransArray = condenseTranslateArray[i].split('~')
                let jLength = 0
                if (condArray.length === condTransArray.length){
                    jLength = condArray.length 
                } else {
                    alert(`jLengths are not equal: (${i}+1)` )
                    console.log(condArray)
                    console.log(condTransArray)
                    jLength = Math.min(condArray.length, condTransArray.length)
                }
                for (let j = 0; j < jLength; j++){
                    if( condArray[j] == condTransArray[j]){
                        str += condArray[j]+'\n'+'\n'+'\n-------\n'
                        
                    } else {
                        str += condArray[j]+'\n'+condTransArray[j]+'\n-------\n'
                    }
                }
                str += `(${i})==============\n`
                // str += condenseArray[i] + '\n----------\n' + condenseTranslateArray[i] + '\n///////////////////////////////\n'  
            }
            combineTA.textContent = str
        }
        const rawTA = document.getElementById("rawTA")
        const separateTA = document.getElementById("separateTA")
        const condenseTA = document.getElementById("condenseTA")
        const translateTA = document.getElementById("translateTA")
        const condenseTranslateTA = document.getElementById("condenseTranslateTA")
        const combineTA = document.getElementById("combineTA")
        rawTA.focus()
    </script>
</body>
</html>